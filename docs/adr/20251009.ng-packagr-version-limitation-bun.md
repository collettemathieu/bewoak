# Architecture Decision Record (ADR)

## Title

Limitation of ng-packagr to version 19.2.2 due to incompatibility with Bun 1.2.23

## Status

Accepted

## Context

With Bun version 1.2.23, we encounter a critical incompatibility with ng-packagr version 20.3.0. This incompatibility stems from the `find-cache-directory` dependency version 6.0.0 used by ng-packagr 20.3.0, which requires Node.js version 20 minimum to support `require` for ESM modules.

The problem manifests as:

- Inability to install ng-packagr 20.3.0 with Bun 1.2.23
- A transitive dependency that requires Node.js features not yet supported by the current version of Bun
- A blocking issue for updating our Angular build stack

This situation forces us to choose between:

1. Maintaining Bun as package manager and runtime
2. Upgrading ng-packagr to the latest version

## Decision

We decide to maintain ng-packagr at version 19.2.2 and continue using Bun 1.2.23 as our primary package manager and runtime.

This decision is motivated by:

- The stability of our current development environment
- Bun's superior performance compared to npm/yarn
- The preference for a single runtime (Bun) rather than a hybrid environment
- The fact that ng-packagr 19.2.2 meets our current needs

## Alternatives Considered

### Alternative 1: Switch to Node.js 20+ and npm/yarn

- **Advantages**: Access to ng-packagr 20.3.0 and later versions
- **Disadvantages**: Loss of Bun performance, migration complexity, potential compatibility issues with existing code

### Alternative 2: Hybrid environment (Bun + Node.js)

- **Advantages**: Keep Bun for development, use Node.js for ng-packagr
- **Disadvantages**: Increased complexity, maintenance of two environments, team confusion

### Alternative 3: Wait for a Bun update

- **Advantages**: Ideal long-term solution
- **Disadvantages**: No clear timeline, blocks critical updates

## Consequences

### Positive

- Stable and consistent development environment
- Maintained Bun performance benefits
- Technical stack simplicity
- No regression on existing functionality

### Negative

- Unable to benefit from new features in ng-packagr 20.3.0+
- Potential security issues not fixed in newer versions
- Dependency on Bun evolution for future updates
- Risk of growing divergence from standard Angular ecosystem

### Risks

- Progressive obsolescence of ng-packagr 19.2.2
- Future migration difficulties if Bun compatibility is delayed
- Potential limitations for new Angular features

## References

- [Issue ng-packagr #3099](https://github.com/ng-packagr/ng-packagr/issues/3099)
- [Documentation Bun 1.2.23](https://bun.sh/docs)
- [ng-packagr releases](https://github.com/ng-packagr/ng-packagr/releases)

## Date

2025-10-09

## Authors

- Assistant AI (rédaction initiale basée sur l'analyse de la problématique)